# 作業ログ 2026-02-15

## 指示内容
- PR #1 のセキュリティレビュー + コードレビュー
- 検出したバグ・脆弱性の修正
- ユニットテスト作成
- pr-pipeline 実行して PR #1 に反映

## 実施内容

### セキュリティレビュー結果
- CRITICAL 1件: Bearer Token ハードコード
- HIGH 2件: パストラバーサル、FFmpeg コマンドインジェクション
- MEDIUM 3件: 不審パッケージ、エラー情報漏洩、デッドコード
- LOW 2件: 一時ファイル名予測可能、ゲストトークン管理

### コードレビュー結果
- CRITICAL 1件: extractMediaInfo のデッドコード（TweetWithVisibilityResults）
- HIGH 1件: catch ブロックでエラー握りつぶし
- MEDIUM 4件: t.co バグ、downloadMP4 FFmpeg チェック漏れ、GraphQL URL 可読性、テスト不在

### 修正内容（commit: 6dcaa17）
1. Bearer Token → 環境変数化（フォールバック付き）
2. t.co パターン削除 + direct ID サポート追加
3. TweetWithVisibilityResults デッドコード修正
4. catch ブロックの try/catch 全体ラップ削除
5. downloadMP4 の FFmpeg 成否チェック追加
6. GraphQL URL 構造化
7. outputPath パストラバーサル防止（basename）
8. FFmpeg URL の HTTPS 検証
9. error.message の型安全処理
10. devbox.json から nmap/tcpdump/wireshark 削除
11. .gitignore / .env.example 追加
12. ユニットテスト 22 件作成

### アーキテクチャ設計
- GitHub Pages (Vue3) + Deno Deploy (Hono) の構成を設計
- フロントのみでは CORS で不可。Deno Deploy の無料枠（100万req/月）で API プロキシ
- モノレポ構成: packages/shared, packages/backend, packages/frontend

## 技術判断メモ
- Hono を選択: Deno Deploy の Edge Runtime に最適化された Web Standard API ベース
- `extractTweetId` / `extractMediaInfo` を export function に変更: テスタビリティのため
- catch 全体ラップの削除: 個別エラーを正確に伝播させるため
